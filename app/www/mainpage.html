<!DOCTYPE html>
<html>
  <head>
    <title>MindSync</title>

    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script type="text/javascript" charset="utf-8" src="js/jsonhttprequest.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>

    <script type="text/javascript">

        function createCanvas() {
          var JHR = new JSONHttpRequest();
          var address = "http://mindsync-itu.herokuapp.com/canvas/new";
          var canvasName = document.getElementById("new-canvas").value;

          if (canvasName) {
            var jsonObj = { name: canvasName };
            JHR.open("POST", address, false);

            JHR.onreadystatechange = function() {
              if (JHR.readyState == 4) {
                localStorage.canvasId = JHR.responseJSON.id;
              }
            }

            JHR.sendJSON(jsonObj);
            return true;
          }
          return false;
        }

        function escapeHtml(text) {
          return text
              .replace(/&/g, "&amp;")
              .replace(/</g, "&lt;")
              .replace(/>/g, "&gt;")
              .replace(/"/g, "&quot;")
              .replace(/'/g, "&#039;");
        }

        function setWidth(){
            document.getElementById("main-canvas").width = screen.width;
        }

        function setHeight(){
            document.getElementById("main-canvas").height = document.documentElement.clientHeight - 60;
        }

        function setLengths(){
            setWidth();
            setHeight();
        }

        function setChatHeight(){
          document.getElementById("chat-bar-textarea").style.height = (document.getElementById("chat-bar").clientHeight - (10+22+40+15)) + "px";
        }

        function chatToggle(){
            console.log(document.getElementById("chat").style.left);
            if(document.getElementById("chat").style.left == (-1) * (document.getElementById("chat").clientWidth + 1) +"px"){
                document.getElementById("chat").style.left = "0";    
            }
            else {
                document.getElementById("chat").style.left = (-1) * (document.getElementById("chat").clientWidth + 1) + "px";
            }
            
        }

        function toolsToggle(){
            console.log(document.getElementById("tools").style.right);
            if(document.getElementById("tools").style.right == (-1) * (document.getElementById("tools").clientWidth + 1) + "px"){
                document.getElementById("tools").style.right = "0";    
            }
            else {
                document.getElementById("tools").style.right = (-1) * (document.getElementById("tools").clientWidth + 1) + "px";
            }
        }

        function chatKeyPressed(e) {
            if (e.keyCode == 13) {
                sendMessage();
            }
        }

        function getCurrentUserName() {
          // TODO localStorage.userName
          return "UserX";
        }

        function getCurrentUserColor() {
          // TODO localStorage.color
          return "blue";
        }

        function sendMessage() {
            msg = document.getElementById('chat-input').value;
            if (msg != "") {
                msg = escapeHtml(msg);
                var spanMsg = document.createElement('span');
                spanMsg.className = getCurrentUserColor() + "-dark-text";
                spanMsg.innerHTML = getCurrentUserName() + ": ";
                document.getElementById('chat-bar-textarea').appendChild(spanMsg);
                document.getElementById('chat-bar-textarea').innerHTML += msg + "<br>";
                document.getElementById('chat-input').value = "";
                // TODO send msg
            }
        }
        
        function setUIColor() {
            color = getCurrentUserColor();
            document.getElementById('chat-bar').className = color + "-light";
            document.getElementById('tools-bar').className = color + "-light";
            document.getElementById('chat-button-img').className = color + "-light";
            document.getElementById('tools-button-img').className = color + "-light";
            document.getElementById('menu').className = "color-gradient " + color + "-light";
        }

        function setToolbarIcon(el) {
          document.getElementById('tools-button-img').src = el.getElementsByTagName('img')[0].src;
        }

        window.onload = function() {
            setLengths();
            setUIColor();
            setChatHeight();
            chatToggle();
            toolsToggle();
        }

        window.onresize = function(){
            setChatHeight();
            setLengths();
        }

    </script>
  </head>
  <body>
  <div id="container">
    <canvas id="main-canvas">
    </canvas>

    <div id="chat">
        <div id="chat-bar">
          <h4 id="chat-bar-head">Chat:</h4>
          <div id="chat-bar-textarea">
            <span class="green-dark-text">User1: </span>Ahoj lidi!<br>
            <span class="violet-dark-text">User2: </span>Zdarec<br>
          </div>
          <div id="chat-bar-bottom">
            <input onkeypress="chatKeyPressed(event)" type="text" id="chat-input">
            <button onclick="sendMessage()" id="chat-send">Send</button>
          </div>
        </div>
        <div id="chat-shadow">
            <a href="#" onclick="chatToggle()" id="chat-button"><img src="img/message.png" alt="chat" id="chat-button-img"/></a>
        </div>
    </div>

    <div id="tools">
        <div id="tools-shadow">
            <a href="#" id="tools-button" onclick="toolsToggle()"><img src="img/tuzka.png" alt="tools" id="tools-button-img"/></a>
        </div>
        <div id="tools-bar">
            <table id="tool-table">
              <tr>
                <td>
                  <button onclick="setToolbarIcon(this)"><img src="img/tuzka.png" alt="pencil" /></button>
                </td>
                <td>
                  <button onclick="setToolbarIcon(this)"><img src="img/stetec.png" alt="brush" /></button>
                </td>
              </tr>
              <tr class="sep">
                <td>
                  <button onclick="setToolbarIcon(this)"><img src="img/obrazek.png" alt="image" /></button>
                </td>
                <td>
                  <button onclick="setToolbarIcon(this)"><img src="img/guma.png" alt="eraser" /></button>
                </td>
              </tr>
              <tr>
                <td>
                  <button onclick="setToolbarIcon(this)"><img src="img/ctverec.png" alt="rectangle" /></button>
                </td>
                <td>
                  <button onclick="setToolbarIcon(this)"><img src="img/kruh.png" alt="circle" /></button>
                </td>
              </tr>
              <tr class="sep">
                <td>
                  <button onclick="setToolbarIcon(this)"><img src="img/krychle.png" alt="box" /></button>
                </td>
                <td>
                  <button onclick="setToolbarIcon(this)"><img src="img/valec.png" alt="cylinder" /></button>
                </td>
              </tr>
              <tr>
                <td>
                  <button onclick="setToolbarIcon(this)"><img src="img/text.png" alt="text" /></button>
                </td>
                <td>
                  <button onclick="setToolbarIcon(this)"><img src="img/sipka.png" alt="arrow" /></button>
                </td>
              </tr>
            </table>
        </div>
    </div>
    <div id="push"></div>
  </div>
  <div id="menu" class="color-gradient">
    <ul id="right-part">
      <li class="bottom-bar"><a href="#"><img src="img/undo.png" alt="undo" /></a></li>
      <li class="bottom-bar"><a href="#"><img src="img/redo.png" alt="redo" /></a></li>
      <li class="bottom-bar"><a href="#"><img src="img/ulozeni.png" alt="save" /></a></li>
      <li class="bottom-bar"><a href="#"><img src="img/nastaveni.png" alt="settings" /></a></li>
    </ul>
    <ul id="left-part">
      <li class="bottom-bar"><a href="#"><img src="img/cara_tuzka_plna.png" alt="solid line" title="solid line"/></a></li>
      <li class="bottom-bar"><a href="#"><img src="img/cara_tuzka_prerusovana.png" alt="dotted line" title="dotted line"/></a></li>
      <li class="bottom-bar"><a href="#"><img src="img/cara_tuzka_teckovana.png" alt="dashed line" title="dashed line"/></a></li>
    </ul>
    <ul id="slider">
      <li class="bottom-bar"><a href="#"><img src="img/no_img.svg" alt="slider" title="slider"/></a></li>
    </ul>
  </div>
</body>
</html>
